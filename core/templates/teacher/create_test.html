<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>{% if test %}Edit Test{% else %}Create Test{% endif %}</title>

<!-- Quill -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: #f4f6f8;
  color: #1f2937;
}

.page {
  display: grid;
  grid-template-columns: 220px 1fr 320px;
  height: 100vh;
}

/* MAIN */
.main {
  padding: 28px;
  overflow-y: auto;
}

/* HEADER */
.header {
  display: grid;
  grid-template-columns: 1fr 1fr auto;
  gap: 16px;
  margin-bottom: 22px;
}

.header input {
  padding: 12px 14px;
  border-radius: 10px;
  border: 1px solid #d1d5db;
  font-size: 15px;
}

/* ACTIONS */
.actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.actions button {
  border-radius: 10px;
  padding: 10px;
  font-size: 14px;
  cursor: pointer;
  border: 1px solid #d1d5db;
  background: #f9fafb;
}

.actions .primary {
  background: #2563eb;
  color: white;
  border: none;
}

/* QUESTIONS */
.questions {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.question-card {
  background: white;
  border-radius: 14px;
  padding: 16px 18px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 4px 14px rgba(0,0,0,.05);
  position: relative;
}

.question-text {
  font-weight: 500;
  margin-bottom: 6px;
}

.answer-text {
  font-size: 13px;
  color: #6b7280;
}

/* Question actions */
.q-actions {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 8px;
}

.q-btn {
  border-radius: 50%;
  width: 32px;
  height: 32px;
  border: 1px solid #d1d5db;
  background: white;
  cursor: pointer;
}

/* RIGHT PANEL */
.side-panel {
  background: #fafafa;
  border-left: 1px solid #e5e7eb;
  padding: 20px;
}

.side-panel h3 {
  margin-top: 0;
  font-size: 16px;
}

/* MODAL */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.4);
  display: none;
  align-items: center;
  justify-content: center;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: white;
  width: 900px;
  max-height: 90vh;
  overflow-y: auto;
  border-radius: 14px;
  padding: 20px;
}

.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 14px;
}
</style>
</head>

<body>

<div class="page">

{% include "teacher/sidebar_teacher.html" %}

<!-- MAIN -->
<main class="main">

<form method="post">
{% csrf_token %}

<!-- HEADER -->
<div class="header">
  <input name="title" placeholder="Test name" value="{{ test.title|default_if_none:'' }}" required>
  <input name="schedule" placeholder="Duration / start time" value="{{ test.schedule|default_if_none:'' }}">
  <div class="actions">
    <button type="button" onclick="openEditor()">âž• New Question</button>
    <button type="button" onclick="openImport()">ðŸ“š Import from Library</button>
    <button type="submit" class="primary">Save Test</button>
  </div>
</div>

<!-- QUESTIONS -->
<div class="questions">

{% if questions %}
  {% for q in questions %}
  <div class="question-card">
    <div class="q-actions">
      <button type="button" class="q-btn">âœŽ</button>
      <button type="button" class="q-btn">âœ•</button>
    </div>

    <div class="question-text">
      {{ q.question_text|striptags|truncatechars:120 }}
    </div>

    <div class="answer-text">
      {{ q.answer_text|striptags|truncatechars:120 }}
    </div>
  </div>
  {% endfor %}
{% else %}
  <p><em>No questions added yet.</em></p>
{% endif %}

</div>

</form>
</main>

<!-- SIDE PANEL -->
<aside class="side-panel">
  <h3>Test settings</h3>

  <label>
    <input type="checkbox" name="is_published"
      {% if test and test.is_published %}checked{% endif %}>
    Published
  </label>

  <hr>

  <h3>Assign test</h3>
  <label><input type="checkbox"> Class 8A</label>
  <label><input type="checkbox"> Class 8B</label>
  <label><input type="checkbox"> Student â€“ Rahul</label>
</aside>

</div>

<!-- QUESTION EDITOR MODAL -->
<div class="modal" id="editorModal">
  <div class="modal-content">
    <h3>Question</h3>
    <div id="questionEditor" style="height:180px"></div>

    <h3 style="margin-top:14px">Answer / Mark Scheme</h3>
    <div id="answerEditor" style="height:160px"></div>

    <div class="modal-actions">
      <button onclick="closeEditor()">Cancel</button>
      <button class="primary">Save Question</button>
    </div>
  </div>
</div>

<!-- IMPORT MODAL -->
<div class="modal" id="importModal">
  <div class="modal-content">
    <h3>Import questions from library</h3>

    <p><em>Filter UI goes here (Grade / Subject / Topic / LO)</em></p>

    <div class="modal-actions">
      <button onclick="closeImport()">Close</button>
      <button class="primary">Import Selected</button>
    </div>
  </div>
</div>

<!-- Quill -->
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script>
const questionQuill = new Quill("#questionEditor", {
  theme: "snow",
  modules: { toolbar: [["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}]] }
});

const answerQuill = new Quill("#answerEditor", {
  theme: "snow",
  modules: { toolbar: [["bold","italic"],[{list:"ordered"}]] }
});

function openEditor() {
  document.getElementById("editorModal").classList.add("active");
}
function closeEditor() {
  document.getElementById("editorModal").classList.remove("active");
}

function openImport() {
  document.getElementById("importModal").classList.add("active");
}
function closeImport() {
  document.getElementById("importModal").classList.remove("active");
}
</script>

</body>
</html>
